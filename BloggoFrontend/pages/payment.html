<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="../css/payment.css" rel="stylesheet">
</head>
<body>

<header class="sticky-top">
    <nav class="glass-navbar align-items-center">
        <h1 class="navbar-brand" href="#" aria-label="Bloggo Home">BLOGGO</h1>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <a href="dashboard.html"><i class="fas fa-home me-1"></i> Home</a>
        <a href="notification.html"><i class="fas fa-bell me-1"></i> Notifications</a>
        <a href="membership.html"><i class="fas fa-star me-1"></i> Membership</a>


        <!-- User Profile Menu -->
        <div class="dropdown profile-menu">
            <a href="#" class="d-block" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="../assets/boy%20(1).png" class="avatar" alt="Profile Avatar">
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li>
                    <a class="dropdown-item" href="stories.html">
                        <i class="fas fa-user me-2"></i> Profile
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="saved-bookmarks.html">
                        <i class="fas fa-bookmark me-2"></i> My Library
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="membership.html">
                        <i class="fas fa-star me-2"></i> Become a Member
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="settings.html">
                        <i class="fas fa-cog me-2"></i> Settings
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="logout.html" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>
<button id="payhere-payment">Pay with PayHere</button>

<!--

<form method="post" action="http://localhost:8080/api/v1/payment/create" class="mt-5 card p-3">
    <div class="mb-3">
        <label for="method" class="form-label">Payment Method</label>
        <input id="method" name="method" type="text" class="form-control" value="PayPal" readonly>
    </div>

    <div class="mb-3">
        <label for="amount" class="form-label">Amount</label>
        <input id="amount" name="amount" type="number" step="0.01" class="form-control" value="10.0">
    </div>

    <div class="mb-3">
        <label for="currency" class="form-label">Currency</label>
        <select class="form-control" id="currency" name="currency">
            <option value="USD" selected>USD</option>
            <option value="LKR">LKR</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
        </select>
    </div>

    <div class="mb-3">
        <label for="description" class="form-label">Description</label>
        <input id="description" name="description" type="text" class="form-control">
    </div>

    <div class="d-flex justify-content-center">
        <button type="submit" class="btn btn-primary">Pay with PayPal</button>
    </div>
</form>
-->


<!-- Checkout Progress -->
<div class="checkout-steps">
    <div class="step ">
        <div class="step-circle">1</div> Plan
    </div>
    <div class="step active">
        <div class="step-circle">2</div> Payment
    </div>
    <div class="step">
        <div class="step-circle">3</div> Confirmation
    </div>
</div>

<div class="container text-center mb-5">
    <p class="text-muted">Secure checkout process ‚Äî your data is protected üîí</p>
</div>
<script src="../js/payment.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://www.payhere.lk/lib/payhere.js"></script>


<script>
    // PayHere event handlers
    payhere.onCompleted = function(orderId) {
        console.log("‚úÖ Payment completed. OrderID: " + orderId);
    };

    payhere.onDismissed = function() {
        console.log("‚ùå Payment dismissed");
    };

    payhere.onError = function(error) {
        console.log("‚ö†Ô∏è Error: " + error);
    };

    document.getElementById('payhere-payment').onclick = async function () {
        const orderId = "ORDER123";
        const amount = 1000.00;
        const currency = "LKR";

        // 1Ô∏è‚É£ Fetch secure hash from backend
        const res = await fetch("http://localhost:8080/api/v1/payments/generate-hash?orderId="
            + orderId + "&amount=" + amount + "&currency=" + currency, {
            method: "POST"
        });
        const hash = await res.text();

        // 2Ô∏è‚É£ Build payment object
        var payment = {
            "sandbox": true,
            "merchant_id": "",
            "return_url": "http://localhost:8080/api/v1/payments/success",
            "cancel_url": "http://localhost:8080/api/v1/payments/cancel",
            "notify_url": "http://your-public-domain.com/api/v1/payments/notify",
            "order_id": orderId,
            "items": "Test Product",
            "amount": amount.toFixed(2),
            "currency": currency,
            "hash": hash,
            "first_name": "Sasuni",
            "last_name": "Wijerathne",
            "email": "sasuni@example.com",
            "phone": "0712345678",
            "address": "Colombo",
            "city": "Colombo",
            "country": "Sri Lanka"
        };

        // 3Ô∏è‚É£ Start PayHere popup
        payhere.startPayment(payment);
    };
</script>
</body>
</html>