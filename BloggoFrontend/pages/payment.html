<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payment</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="../css/payment.css" rel="stylesheet">
</head>
<body>

<header class="sticky-top">
    <nav class="glass-navbar align-items-center">
        <h1 class="navbar-brand" href="#" aria-label="Bloggo Home">BLOGGO</h1>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <a href="dashboard.html"><i class="fas fa-home me-1"></i> Home</a>
        <a href="notification.html"><i class="fas fa-bell me-1"></i> Notifications</a>
        <a href="membership.html"><i class="fas fa-star me-1"></i> Membership</a>


        <!-- User Profile Menu -->
        <div class="dropdown profile-menu">
            <a href="#" class="d-block" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <img src="../assets/boy%20(1).png" class="avatar" alt="Profile Avatar">
            </a>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
                <li>
                    <a class="dropdown-item" href="stories.html">
                        <i class="fas fa-user me-2"></i> Profile
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="saved-bookmarks.html">
                        <i class="fas fa-bookmark me-2"></i> My Library
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="membership.html">
                        <i class="fas fa-star me-2"></i> Become a Member
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="settings.html">
                        <i class="fas fa-cog me-2"></i> Settings
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="logout.html" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                    </a>
                </li>
            </ul>

        </div>
    </nav>
</header>


<div class="d-flex justify-content-center align-items-center vh-60 bg-light">
    <div class="card shadow-lg rounded-4 text-center p-4" style="max-width: 600px; width: 100%; border: none;">
        <!-- Header -->
        <h2 class="text-primary fw-bold mb-2">Premium Membership</h2>
        <p class="text-muted mb-4">Unlock exclusive features designed for you:</p>

        <!-- Features List -->
        <ul class="list-unstyled text-start mb-4 px-3">
            <li class="mb-2"><i class="fas fa-check text-success me-2"></i> Unlimited article access</li>
            <li class="mb-2"><i class="fas fa-check text-success me-2"></i> Earning within blogs</li>
            <li class="mb-2"><i class="fas fa-check text-success me-2"></i> Monthly newsletter</li>
            <li><i class="fas fa-check text-success me-2"></i> Priority support</li>
        </ul>

        <!-- Price -->
        <h3 class="fw-bold mb-4">$5 / month</h3>

        <!-- CTA Button -->
        <button id="payhere-membership" class="btn btn-primary btn-lg w-100 shadow-sm">
            <i class="fas fa-credit-card me-2"></i> Pay with PayHere
        </button>

        <!-- Footer / Trust Microcopy -->
        <p class="text-muted mt-3" style="font-size: 0.9rem;">Secure checkout ‚Äî your data is protected üîí</p>
    </div>
</div>




<!-- Checkout Progress -->
<div class="checkout-steps">
    <div class="step ">
        <div class="step-circle">1</div> Plan
    </div>
    <div class="step active">
        <div class="step-circle">2</div> Payment
    </div>
</div>

<div class="container text-center mb-5">
    <p class="text-muted">Secure checkout process ‚Äî your data is protected üîí</p>
</div>
<script src="../js/payment.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://www.payhere.lk/lib/payhere.js"></script>


<script>
    // PayHere event handlers
    payhere.onCompleted = function(orderId) {
        console.log("‚úÖ Payment completed. OrderID: " + orderId);
        alert("Payment completed. OrderID: " + orderId);
        window.location.href = "stories.html";
    };

    payhere.onDismissed = function() {
        console.log("‚ùå Payment dismissed");

    };

    payhere.onError = function(error) {
        console.log("‚ö†Ô∏è Error: " + error);
    };

    document.getElementById('payhere-payment').onclick = async function () {
        const orderId = "ORDER123";
        const amount = 1500.00;
        const currency = "LKR";

        // 1Ô∏è‚É£ Fetch secure hash from backend
        const res = await fetch("http://localhost:8080/api/v1/payments/generate-hash?orderId="
            + orderId + "&amount=" + amount + "&currency=" + currency, {
            method: "POST"
        });
        const hash = await res.text();

        // 2Ô∏è‚É£ Build payment object
        var payment = {
            "sandbox": true,
            "merchant_id": "",
            "return_url": "http://localhost:8080/api/v1/payments/success",
            "cancel_url": "http://localhost:8080/api/v1/payments/cancel",
            "notify_url": "http://your-public-domain.com/api/v1/payments/notify",
            "order_id": orderId,
            "items": "Test Product",
            "amount": amount.toFixed(2),
            "currency": currency,
            "hash": hash,
            "first_name": "Sasuni",
            "last_name": "Wijerathne",
            "email": "sasuni@example.com",
            "phone": "0712345678",
            "address": "Colombo",
            "city": "Colombo",
            "country": "Sri Lanka"
        };

        // 3Ô∏è‚É£ Start PayHere popup
        payhere.startPayment(payment);
    };
</script>
</body>
</html>